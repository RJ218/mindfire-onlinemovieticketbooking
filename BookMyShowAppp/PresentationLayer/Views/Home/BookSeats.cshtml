<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>BookSeats</title>

    <link href="~/Content/css/BookSeats.css" rel="stylesheet" />
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.4.1.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
</head>
<body style="background-color:#af9292!important;">
    <div class="movie-container">
        <h1 id="pvrname"></h1>
    </div>
    <ul class="showcase">
        <li>
            <div class="seat"></div>
            <small>N\A</small>
        </li>
        <li>
            <div class="seat selected"></div>
            <small>Selected</small>
        </li>
        <li>
            <div class="seat occupied"></div>
            <small>Occupied</small>
        </li>
    </ul>
    <div class="container" style="max-width:600px!important;">
        <div class="screen" style="margin-left:30px!important;width:90%!important">
        </div>
        <div class="row" style="margin-left:150px!important;">
            
    </div>
        </div>
    <!--<p class="text">you have selected <span id="count">0</span> seats for price Rs <span id="total">0</span></p>-->
    <p class="text"> you have selected <span id="count">0</span> seats</p>
    <button type="button" class="btn btn-success" id="btn" >Pay Now</button>
    
    <script>
       document.getElementById("pvrname").innerHTML = localStorage.getItem("theatrenm");
       var arr = [];
       var ThData = localStorage.getItem("theatreid");
       
       console.log(ThData);
       
        $.ajax(
            {
                type: "GET", url: "http://localhost:60562//api/GetTheatreId?theatreid="+ThData  ,
                success: (response) => {
                   
                    var x = JSON.stringify(response);
                    console.log(ThData);
                    var y = JSON.parse(x);
                    for(var i=0;i<y.length;i++)
                    {
                        if (i % 6 == 0) {
                            $(".row")[0].innerHTML += "<br/>" + "<div class='seat' id="+y[i]['SeatId']+" onclick='xx("+y[i]['SeatId']+")'>" + y[i]['SeatNo'] + "</div>";
                        }
                        else { $(".row")[0].innerHTML += "<div class='seat'  id=" + y[i]['SeatId'] + " onclick='xx(" + y[i]['SeatId'] + ")'> " + y[i]['SeatNo'] + "</div>"; }
                        
                    }
                },
                 error : (err) => {
                    alert(err);
                    console.log(err);
                }

            });
        
            const container = document.querySelector(".container");
            const seats = document.querySelectorAll(".row .seat:not(.occupied)");
            const count = document.getElementById("count");
            console.log(count);
            function updateSelectedCount() {
                const selectedSeats = document.querySelectorAll(".row .seat.selected");
                const selectedSeatsCount = selectedSeats.length;
                count.innerText = selectedSeatsCount;
            }
            container.addEventListener("click", function (e) {
                if (e.target.classList.contains("seat") && !e.target.classList.contains("occupied")) {
                    var x = e.target.classList.toggle("selected");
                    if (x)
                    {
                       // console.log(x);
                        document.getElementById("btn").addEventListener("click", function () {
                            if (e.target.classList.contains("selected")) {
                                e.target.classList.remove("selected");
                                e.target.classList.add("occupied");
                    
                                //console.log(obj);
                            }
                           
                        });
                       
                    }
                    updateSelectedCount();
                }
               
            });
           
          
            function xx(id) {
                if (document.getElementById(id).className=="seat")
                    arr.push(id);
                else
                    arr.pop(id);
                    console.log(arr);
               // console.log(document.getElementById(id).className);
            }
            document.getElementById("btn").addEventListener("click", function () {
                {
                   var array = [];
                    console.log(arr.length);
                    for (var i = 0; i < arr.length; i++)
                    {
                       array.push({ "getseat": arr[i] });
                        
                    }
                   
                    var obj = { "ShowId": localStorage.getItem("showid"), "Date": localStorage.getItem("time"), "TicketQuantity": arr.length, "SeatF":array };
                    console.log(obj);
                    $.ajax(
                       {
                           type: "POST", url: "http://localhost:60562//api/SubmitSeats", data: obj, datatype: "json", success: (response) => {
                               alert("success");
                           },
                           error: (err) => {
                               alert(err);
                               console.log(err);
                           }

                       })

                    
                }
            });
    </script>
</body>
</html>
